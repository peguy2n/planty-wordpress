import{c as o}from"./p-25433d0f.js";import{i,a as l,g as d}from"./p-f70181c4.js";import{g as v}from"./p-c06b2e12.js";import{s as n}from"./p-09484d0e.js";const u=i=>{const l=new CustomEvent("scProductViewed",{detail:{id:null==i?void 0:i.id,name:null==i?void 0:i.name,permalink:null==i?void 0:i.permalink,prices:null==i?void 0:i.prices},bubbles:!0});document.dispatchEvent(l)},t=i=>{var l;return((null===(l=j[i])||void 0===l?void 0:l.prices)||[]).filter((i=>!(null==i?void 0:i.archived))).sort(((i,l)=>(null==i?void 0:i.position)-(null==l?void 0:l.position)))},s=i=>{var l;return null!==(l=j[i])&&void 0!==l?l:null},e=i=>{var l,o,d,n;return!(!(null===(o=null===(l=null==j?void 0:j[i])||void 0===l?void 0:l.product)||void 0===o?void 0:o.stock_enabled)||(null===(n=null===(d=null==j?void 0:j[i])||void 0===d?void 0:d.product)||void 0===n?void 0:n.allow_out_of_stock_purchases))},a=(l,o,d)=>i(o,d,j[l].variantValues,j[l].product),r=(i,o,d)=>l(o,d,j[i].variantValues,j[i].product),c=i=>{var l,o,d,n;return!!e(i)&&((null===(o=null===(l=null==j?void 0:j[i])||void 0===l?void 0:l.selectedVariant)||void 0===o?void 0:o.id)?(null===(n=j[i].selectedVariant)||void 0===n?void 0:n.available_stock)<=0:(null===(d=j[i].product)||void 0===d?void 0:d.available_stock)<=0)},p=i=>{var l,o,d;return!!(null===(o=null===(l=null==j?void 0:j[i])||void 0===l?void 0:l.variants)||void 0===o?void 0:o.length)&&void 0===(null===(d=v({variants:j[i].variants,values:j[i].variantValues}))||void 0===d?void 0:d.id)},f=()=>{const{product:i={}}=d();return Object.values(i).reduce(((i,l)=>{const{selectedPrice:o,product:d,selectedVariant:n}=l||{},t={...l,quantity:1,total:null,dialog:null,busy:!1,error:null,adHocAmount:(null==o?void 0:o.amount)||null,disabled:(null==o?void 0:o.archived)||(null==d?void 0:d.archived),line_item:{price_id:null==o?void 0:o.id,quantity:1,...(null==o?void 0:o.ad_hoc)?{ad_hoc_amount:null==o?void 0:o.amount}:{}},variantValues:{...(null==n?void 0:n.option_1)?{option_1:null==n?void 0:n.option_1}:{},...(null==n?void 0:n.option_2)?{option_2:null==n?void 0:n.option_2}:{},...(null==n?void 0:n.option_3)?{option_3:null==n?void 0:n.option_3}:{}}};return i[d.id]=t,i}),{})||{}},m=i=>(t(i)||[]).filter((i=>null==i?void 0:i.recurring_interval)).sort(((i,l)=>(null==i?void 0:i.position)-(null==l?void 0:l.position))),b=i=>(t(i)||[]).filter((i=>!(null==i?void 0:i.recurring_interval))).sort(((i,l)=>(null==i?void 0:i.position)-(null==l?void 0:l.position))),_=Object.freeze({__proto__:null,availablePrices:t,getProduct:s,isStockNeedsToBeChecked:e,isOptionSoldOut:a,isOptionMissing:r,isProductOutOfStock:c,isSelectedVariantMissing:p,getDefaultState:f,availableSubscriptionPrices:m,availableNonSubscriptionPrices:b}),O=f();Object.values(O).filter((i=>null==i?void 0:i.isProductPage)).forEach((i=>{var l;(null===(l=null==i?void 0:i.product)||void 0===l?void 0:l.id)&&u(null==i?void 0:i.product)}));const S=o(O,((i,l)=>JSON.stringify(i)!==JSON.stringify(l))),{state:j,onChange:g,on:h,dispose:N,forceUpdate:P}=S,y=(i,l)=>{i&&(j[i]={...j[i],...l})};h("set",((i,l,o)=>{var d,n,t,e;(null===(d=null==l?void 0:l.selectedPrice)||void 0===d?void 0:d.id)!==(null===(n=null==o?void 0:o.selectedPrice)||void 0===n?void 0:n.id)&&q(i,l),(null===(t=null==l?void 0:l.selectedVariant)||void 0===t?void 0:t.id)!==(null===(e=null==o?void 0:o.selectedVariant)||void 0===e?void 0:e.id)&&k(i);const a=!o||["selectedPrice","adHocAmount","quantity"].some((i=>JSON.stringify(l[i])!==JSON.stringify(o[i])));a&&V(i),(!o||JSON.stringify(null==l?void 0:l.variantValues)!==JSON.stringify(null==o?void 0:o.variantValues))&&J(i,l)}));const J=(i,l)=>{const o=v({variants:j[i].variants,values:null==l?void 0:l.variantValues});o&&y(i,{selectedVariant:o})},k=i=>{var l,o,d;j[i].selectedVariant&&e&&(null===(l=j[i])||void 0===l?void 0:l.selectedVariant.available_stock)<(null===(o=j[i])||void 0===o?void 0:o.quantity)&&(j[i].quantity=(null===(d=j[i])||void 0===d?void 0:d.selectedVariant.available_stock)||1,n(wp.i18n.sprintf(wp.i18n.__("There are just %d items left in stock, and the quantity has been adjusted to %d.","surecart"),j[i].quantity,j[i].quantity),"assertive"))},q=(i,l)=>{var o,d,n,t;y(i,{total:j[i].adHocAmount||(null===(o=null==l?void 0:l.selectedPrice)||void 0===o?void 0:o.amount)||0,adHocAmount:null===(d=null==l?void 0:l.selectedPrice)||void 0===d?void 0:d.amount,disabled:(null===(n=null==l?void 0:l.selectedPrice)||void 0===n?void 0:n.archived)||(null===(t=j[i].product)||void 0===t?void 0:t.archived)})},V=i=>{var l,o,d,n,t,e,a,v;y(i,{line_item:{price_id:null===(o=null===(l=j[i])||void 0===l?void 0:l.selectedPrice)||void 0===o?void 0:o.id,quantity:(null===(n=null===(d=j[i])||void 0===d?void 0:d.selectedPrice)||void 0===n?void 0:n.ad_hoc)?1:j[i].quantity,...(null===(e=null===(t=j[i])||void 0===t?void 0:t.selectedPrice)||void 0===e?void 0:e.ad_hoc)?{ad_hoc_amount:null===(a=j[i])||void 0===a?void 0:a.adHocAmount}:{},variant:null===(v=j[i].selectedVariant)||void 0===v?void 0:v.id}})};export{h as a,y as b,p as c,N as d,a as e,P as f,_ as g,r as h,c as i,t as j,g as o,j as s};