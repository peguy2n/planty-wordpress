{"version":3,"names":["safeRead","storage","key","JSON","parse","getItem","debounce","fn","called","setTimeout","createStorageStore","defaultValues","syncAcrossTabs","store","createStore","_a","newValue","oldValue","stringify","write","setItem","state","window","addEventListener","currentState","set","use","reset","createLocalStore","localStorage","removeQueryArgs","url","queryStringIndex","indexOf","query","getQueryArgs","baseURL","substr","_len","arguments","length","args","Array","_key","forEach","arg","queryString","buildQueryString","checkout","getSerializedState","notPersistCart","persist","getQueryArg","location","href","live","test","onChange","on","get","dispose","scStore","formId","groupId","mode","locks","product","currencyCode","abandonedCheckoutEnabled","initialLineItems","isCheckoutPage","validateStock","val","setCheckout","prop","getCheckout","id","_","value","Object","keys","handleCheckoutLineItemChange","oldCheckout","newLineItems","line_items","data","oldLineItems","_b","newItem","oldItem","find","item","quantity","event","CustomEvent","detail","bubbles","document","dispatchEvent","transaction_id","maybeConvertAmount","total_amount","currency","toUpperCase","discount","promotion","code","coupon","_d","_c","tax_amount","tax","items","_e","map","item_name","price","name","discount_amount","amount","status","includes","deprecated","trialLineItems","filter","trial_duration_days","e","dataLayer","gtag","item_id","item_variant","variant_options","join","_f","_g","_h","_j","push","ecommerce","live_mode","checkoutState","history","replaceState","title","addQueryArgs","checkout_id","clearCheckout","remove","checkouts"],"sources":["./src/store/local/storage.ts","../../node_modules/@wordpress/url/build-module/remove-query-args.js","./src/store/checkouts/store.ts","./src/store/checkout/store.ts","./src/store/checkout/watchers.ts","./src/store/checkouts/events.ts","./src/store/checkout/events.ts","./src/store/checkout/google.ts","./src/store/checkouts/mutations.ts"],"sourcesContent":["import { createStore } from '@stencil/store';\nimport { MinimumStorage } from './types';\n\nconst safeRead = <T extends object>(storage: MinimumStorage, key: string): T | null => {\n  try {\n    return JSON.parse(storage.getItem(key));\n  } catch {\n    return null;\n  }\n};\n\nconst debounce = fn => {\n  let called = false;\n  return () => {\n    if (called) {\n      return;\n    }\n    called = true;\n    setTimeout(() => {\n      fn();\n      called = false;\n    }, 0);\n  };\n};\n\nexport const createStorageStore = <T extends object>(storage: MinimumStorage, key: string, defaultValues: T, syncAcrossTabs = false) => {\n  const store = createStore(safeRead<T>(storage, key) ?? defaultValues, (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  });\n\n  // Need to sync later or we would get ourselves in an infinite loop.\n  const write = debounce(() => storage.setItem(key, JSON.stringify(store.state)));\n  write();\n\n  if (syncAcrossTabs) {\n    window.addEventListener('storage', () => {\n      const currentState = safeRead<T>(storage, key);\n\n      if (currentState === null) {\n        return;\n      }\n\n      for (const key in currentState) {\n        store.set(key, currentState[key]);\n      }\n    });\n  }\n\n  store.use({ set: write, reset: write });\n\n  return store;\n};\n\nexport const createLocalStore = <T extends object>(key: string, defaultValues: T, syncAcrossTabs = false) => createStorageStore(localStorage, key, defaultValues, syncAcrossTabs);\nexport const createSessionStore = <T extends object>(key: string, defaultValues: T) => createStorageStore(sessionStorage, key, defaultValues);\n","/**\n * Internal dependencies\n */\nimport { getQueryArgs } from './get-query-args';\nimport { buildQueryString } from './build-query-string';\n/**\n * Removes arguments from the query string of the url\n *\n * @param {string}    url  URL.\n * @param {...string} args Query Args.\n *\n * @example\n * ```js\n * const newUrl = removeQueryArgs( 'https://wordpress.org?foo=bar&bar=baz&baz=foobar', 'foo', 'bar' ); // https://wordpress.org?baz=foobar\n * ```\n *\n * @return {string} Updated URL.\n */\n\nexport function removeQueryArgs(url) {\n  const queryStringIndex = url.indexOf('?');\n\n  if (queryStringIndex === -1) {\n    return url;\n  }\n\n  const query = getQueryArgs(url);\n  const baseURL = url.substr(0, queryStringIndex);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  args.forEach(arg => delete query[arg]);\n  const queryString = buildQueryString(query);\n  return queryString ? baseURL + '?' + queryString : baseURL;\n}\n//# sourceMappingURL=remove-query-args.js.map","import { createLocalStore } from '../local';\nimport { createStore } from '@stencil/store';\nimport { getSerializedState } from '@store/utils';\nimport { getQueryArg } from '@wordpress/url';\nconst { checkout } = getSerializedState();\n\nconst notPersistCart = checkout?.persist !== 'browser' || !!getQueryArg(window.location.href, 'no_cart');\n\nconst store = notPersistCart\n  ? createStore<{ live: any; test: any }>({\n      live: {},\n      test: {},\n    })\n  : createLocalStore<{ live: any; test: any }>(\n      'surecart-local-storage',\n      {\n        live: {},\n        test: {},\n      },\n      true,\n    );\n\nconst { state, onChange, on, set, get, dispose } = store;\nwindow.scStore = store;\nexport default store;\nexport { state, onChange, on, set, get, dispose };\n","import { createStore } from '@stencil/store';\n\nimport { Checkout, LineItemData, Product, TaxProtocol } from '../../types';\nimport { getSerializedState } from '@store/utils';\nconst { checkout } = getSerializedState();\n\ninterface Store {\n  formId: number | string;\n  groupId: string;\n  mode: 'live' | 'test';\n  locks: string[];\n  product: Product;\n  checkout: Checkout;\n  currencyCode: string;\n  abandonedCheckoutEnabled: boolean;\n  initialLineItems: LineItemData[];\n  taxProtocol: TaxProtocol;\n  isCheckoutPage: boolean;\n  validateStock: boolean;\n  persist: 'browser' | 'url' | false;\n}\n\nconst { state, onChange, on, set, get, dispose } = createStore<Store>(\n  {\n    formId: null,\n    groupId: null,\n    mode: 'live',\n    locks: [],\n    product: null,\n    checkout: null,\n    currencyCode: 'usd',\n    abandonedCheckoutEnabled: true,\n    initialLineItems: [],\n    isCheckoutPage: false,\n    validateStock: false,\n    persist: 'browser',\n    ...checkout,\n  },\n  (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  },\n);\n\nexport default state;\nexport { state, onChange, on, set, get, dispose };\n","import state, { onChange, on } from './store';\nimport { getCheckout, setCheckout } from '../checkouts/mutations';\n\n/**\n * When the checkout changes, update the\n * checkout in localstorage.\n */\nonChange('checkout', val => setCheckout(val, state.formId));\n\non('get', prop => {\n  if (prop === 'checkout') {\n    const checkout = getCheckout(state.formId, state.mode);\n    if (checkout?.id) {\n      state.checkout = checkout;\n    }\n  }\n});\n","import { on } from './store';\nimport { Checkout, LineItem } from 'src/types';\n// import { maybeConvertAmount } from '../../functions/currency';\n\n// Listen to all stored checkouts and handle line item changes.\non('set', (_, value, oldValue) => Object.keys(value || {}).forEach(key => handleCheckoutLineItemChange(value[key] as Checkout, oldValue?.[key])));\n\n/**\n * Add to cart/remove from cart, cart updated events.\n */\nexport const handleCheckoutLineItemChange = (checkout: Checkout, oldCheckout: Checkout) => {\n  // get new and old line items.\n  const newLineItems = (checkout as Checkout)?.line_items?.data || [];\n  const oldLineItems = (oldCheckout as Checkout)?.line_items?.data || [];\n\n  // check for added items or quantity changed\n  newLineItems.forEach(newItem => {\n    const oldItem = oldLineItems.find(item => item.id === newItem.id);\n    // an item was added, or the quantity changed.\n    if (!oldItem || oldItem?.quantity < newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scAddedToCart', {\n        detail: {\n          ...newItem,\n          quantity: newItem.quantity - (oldItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check for removed items or quantity changed\n  oldLineItems.forEach(oldItem => {\n    const newItem = newLineItems.find(item => item.id === oldItem.id);\n    // an item was removed, or the quantity changed.\n    if (!newItem || oldItem?.quantity > newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scRemovedFromCart', {\n        detail: {\n          ...oldItem,\n          quantity: oldItem.quantity - (newItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check if line items have changed.\n  if (JSON.stringify(newLineItems) !== JSON.stringify(oldLineItems)) {\n    // emit an event here with the checkout state updates.\n    const event = new CustomEvent<[Checkout, Checkout]>('scCartUpdated', {\n      detail: [checkout, oldCheckout],\n      bubbles: true,\n    });\n    document.dispatchEvent(event);\n  }\n};\n","import '../checkouts/events';\nimport state, { on } from './store';\nimport { Checkout, CheckoutInitiatedParams, LineItem, Product } from 'src/types';\nimport { maybeConvertAmount } from '../../functions/currency';\n\n/**\n * Checkout initiated event.\n */\non('set', (key, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (oldCheckout?.id) return; // we only care about new checkouts.\n  if (!checkout?.id) return; // we don't have a saved checkout.\n  if (!state.isCheckoutPage) return; // we don't want to fire this if we are not on the checkout page.\n\n  const event = new CustomEvent<CheckoutInitiatedParams>('scCheckoutInitiated', {\n    detail: {\n      transaction_id: checkout.id,\n      value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n      currency: (checkout.currency || '').toUpperCase(),\n      ...(checkout?.discount?.promotion?.code ? { coupon: checkout?.discount?.promotion?.code } : {}),\n      ...(checkout?.tax_amount ? { tax: maybeConvertAmount(checkout?.tax_amount, checkout?.currency || 'USD') } : {}),\n      items: (checkout?.line_items?.data || []).map(item => ({\n        item_name: (item?.price?.product as Product)?.name || '',\n        discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, checkout?.currency || 'USD') : 0,\n        price: maybeConvertAmount(item?.price?.amount || 0, checkout?.currency || 'USD'),\n        quantity: item?.quantity || 1,\n      })),\n    },\n    bubbles: true,\n  });\n\n  document.dispatchEvent(event);\n});\n\n/**\n * Purchase complete, trial start event.\n */\non('set', (key, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (!checkout?.status || oldCheckout?.status === checkout?.status) return; // we only care about status changes.\n  if (!['paid', 'processing'].includes(checkout.status)) return; // only if it's paid or processing.\n\n  // order paid is deprecated.\n  const deprecated = new CustomEvent('scOrderPaid', { detail: checkout, bubbles: true });\n  document.dispatchEvent(deprecated);\n\n  // emit the new event.\n  const event = new CustomEvent('scCheckoutCompleted', { detail: checkout, bubbles: true });\n  document.dispatchEvent(event);\n\n  // get trial line items and emit trial event if there are any.\n  const trialLineItems: LineItem[] = (checkout?.line_items?.data || []).filter(item => item?.price?.trial_duration_days > 0);\n  if (trialLineItems.length > 0) {\n    const event = new CustomEvent('scTrialStarted', { detail: trialLineItems, bubbles: true });\n    document.dispatchEvent(event);\n  }\n});\n","import { maybeConvertAmount } from '../../functions/currency';\nimport { LineItem, Product } from 'src/types';\n\n/**\n * Handle add to cart event.\n */\nwindow.addEventListener('scAddedToCart', function (e: CustomEvent) {\n  if (!window?.dataLayer && !window?.gtag) return;\n\n  // get the added item from the event.\n  const item: LineItem = e.detail;\n\n  // sanity check.\n  if (!item?.price?.product) return;\n\n  // create the items array.\n  const items = [\n    {\n      item_id: (item.price?.product as Product)?.id,\n      item_name: (item.price?.product as Product)?.name,\n      item_variant: (item.variant_options || []).join(' / '),\n      price: maybeConvertAmount(item?.price?.amount || 0, item.price?.currency || 'USD'),\n      currency: item.price?.currency,\n      quantity: item.quantity,\n      discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item.price?.currency || 'USD') : 0,\n    },\n  ];\n\n  // handle google analytics script\n  if (window?.gtag) {\n    window.gtag('event', 'add_to_cart', {\n      items,\n    });\n  }\n\n  // handle datalayer\n  if (window?.dataLayer) {\n    window.dataLayer.push({ ecommerce: null });\n    window.dataLayer.push({\n      event: 'add_to_cart',\n      ecommerce: {\n        data: {\n          items,\n        },\n      },\n    });\n  }\n});\n\n/**\n * Handle purchase complete event.\n */\nwindow.addEventListener('scCheckoutCompleted', function (e: CustomEvent) {\n  if (!window?.dataLayer && !window?.gtag) return;\n\n  const checkout = e.detail;\n\n  const data = {\n    transaction_id: checkout?.id,\n    value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n    currency: (checkout.currency || '').toUpperCase(),\n    ...(checkout?.discount?.promotion?.code ? { coupon: checkout?.discount?.promotion?.code } : {}),\n    ...(checkout?.tax_amount ? { tax: maybeConvertAmount(checkout?.tax_amount, checkout?.currency || 'USD') } : {}),\n    items: (checkout?.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      currency: (checkout.currency || '').toUpperCase(),\n      item_name: (item?.price?.product as Product)?.name || '',\n      discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item?.price?.currency || 'USD') : 0,\n      price: maybeConvertAmount(item?.price?.amount || 0, item?.price?.currency || 'USD'),\n      quantity: item?.quantity || 1,\n      item_variant: (item.variant_options || []).join(' / '),\n    })),\n  };\n\n  // handle gtag (analytics script.)\n  if (window?.gtag) {\n    window.gtag('event', 'purchase', data);\n  }\n\n  // handle dataLayer (google tag manager).\n  if (window?.dataLayer) {\n    window.dataLayer.push({ ecommerce: null }); // Clear the previous ecommerce object.\n    window.dataLayer.push({\n      event: 'purchase',\n      ecommerce: data,\n    });\n  }\n});\n","import { Checkout } from 'src/types';\nimport store from './store';\nimport { state as checkoutState } from '@store/checkout';\nimport { addQueryArgs, removeQueryArgs } from '@wordpress/url';\n\n/** Get the checkout. */\nexport const getCheckout = (formId: number | string, mode: 'live' | 'test') => store.state[mode]?.[formId] || {};\n\n/** Set the checkout. */\nexport const setCheckout = (data: Checkout, formId: number | string) => {\n  const mode = data?.live_mode ? 'live' : 'test';\n  store.set(mode, { ...store.state[mode], [formId]: data });\n  // update the current checkout state.\n  if (checkoutState.formId === formId && checkoutState.mode === mode) {\n    checkoutState.checkout = data;\n  }\n  // set in url only if we are not persisting the cart.\n  if (checkoutState.persist === 'url' && data?.id) {\n    window.history.replaceState({}, document.title, addQueryArgs(window.location.href, { checkout_id: data?.id }));\n  }\n};\n\n/** Clear the order from the store. */\nexport const clearCheckout = (formId: number | string, mode: 'live' | 'test') => {\n  const { [formId]: remove, ...checkouts } = store.state[mode];\n  window.history.replaceState({}, document.title, removeQueryArgs(window.location.href, 'redirect_status', 'coupon', 'line_items', 'confirm_checkout_id', 'checkout_id'));\n  return store.set(mode, checkouts);\n};\n"],"mappings":"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"}